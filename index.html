<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 AADS Stats Director</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-6">
    <div class="max-w-4xl w-full">
        <div class="text-center mb-12">
            <div class="flex flex-col items-center justify-center mb-4">
                <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 mb-4">
                    AADS STATS PROGRAM
                </h1>
                <img src="logos/AADS OFFIAL LOGO - Copy.png" alt="AADS Logo" class="h-64 w-auto object-contain mb-4">
            </div>
            <p class="text-xl text-gray-400">Darts Administration System</p>
            <p class="text-sm text-gray-500 mt-2">Complete Event Management Workflow</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Stage 1: Round Robin -->
            <a href="stage1.html" class="group block h-full">
                <div class="bg-gradient-to-br from-green-600 to-green-800 p-8 rounded-2xl shadow-2xl hover:shadow-green-500/50 transition-all duration-300 hover:scale-105 cursor-pointer h-full flex flex-col">
                    <div class="text-center flex-1 flex flex-col justify-between">
                        <div class="text-6xl mb-4">üéØ</div>
                        <div class="text-gray-200 text-sm font-semibold mb-2">STAGE 1</div>
                        <h2 class="text-2xl font-bold mb-3">Round Robin</h2>
                        <p class="text-sm text-green-100 mb-4">Group stage matches and standings</p>
                        <div class="bg-white/20 rounded-lg p-3 text-sm">
                            <p class="font-semibold mb-1">Process:</p>
                            <ul class="text-xs text-left space-y-1">
                                <li>‚Ä¢ Enter 5 players per group</li>
                                <li>‚Ä¢ Score all 20 matches</li>
                                <li>‚Ä¢ Download RR_Data.json</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Stage 2: Knockout -->
            <a href="stage2.html" class="group block h-full">
                <div class="bg-gradient-to-br from-yellow-600 to-orange-800 p-8 rounded-2xl shadow-2xl hover:shadow-yellow-500/50 transition-all duration-300 hover:scale-105 cursor-pointer h-full flex flex-col">
                    <div class="text-center flex-1 flex flex-col justify-between">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <div class="text-gray-200 text-sm font-semibold mb-2">STAGE 2</div>
                        <h2 class="text-2xl font-bold mb-3">Knockout</h2>
                        <p class="text-sm text-yellow-100 mb-4">Bracket tournament to final</p>
                        <div class="bg-white/20 rounded-lg p-3 text-sm">
                            <p class="font-semibold mb-1">Process:</p>
                            <ul class="text-xs text-left space-y-1">
                                <li>‚Ä¢ Upload RR_Data.json</li>
                                <li>‚Ä¢ Auto-seeded bracket</li>
                                <li>‚Ä¢ Download KO_Data.json</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Stage 3: Merger -->
            <a href="merger.html" class="group block h-full">
                <div class="bg-gradient-to-br from-purple-600 to-pink-800 p-8 rounded-2xl shadow-2xl hover:shadow-purple-500/50 transition-all duration-300 hover:scale-105 cursor-pointer h-full flex flex-col">
                    <div class="text-center flex-1 flex flex-col justify-between">
                        <div class="text-6xl mb-4">üìä</div>
                        <div class="text-gray-200 text-sm font-semibold mb-2">STAGE 3</div>
                        <h2 class="text-2xl font-bold mb-3">Stats Merger</h2>
                        <p class="text-sm text-purple-100 mb-4">Combine & calculate final stats</p>
                        <div class="bg-white/20 rounded-lg p-3 text-sm">
                            <p class="font-semibold mb-1">Process:</p>
                            <ul class="text-xs text-left space-y-1">
                                <li>‚Ä¢ Upload both JSON files</li>
                                <li>‚Ä¢ Calculate event 3DA</li>
                                <li>‚Ä¢ Download Final_Stats.json</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <!-- Workflow Guide -->
        <div class="mt-12 bg-gray-800 rounded-xl p-6 border border-gray-700">
            <h3 class="text-xl font-bold mb-4 text-center text-blue-400">Workflow Guide</h3>
            <div class="flex items-center justify-center space-x-4 text-sm">
                <div class="text-center">
                    <div class="bg-green-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">1</div>
                    <p class="text-gray-400">Round Robin</p>
                </div>
                <div class="text-gray-500 text-2xl">‚Üí</div>
                <div class="text-center">
                    <div class="bg-yellow-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">2</div>
                    <p class="text-gray-400">Knockout</p>
                </div>
                <div class="text-gray-500 text-2xl">‚Üí</div>
                <div class="text-center">
                    <div class="bg-purple-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">3</div>
                    <p class="text-gray-400">Merger</p>
                </div>
            </div>
        </div>

        <!-- Player Profile Management -->
        <div class="mt-8 grid md:grid-cols-3 gap-6">
            <a href="profile_editor.html" class="block">
                <div class="bg-gradient-to-r from-indigo-600 to-blue-700 p-6 rounded-xl shadow-xl hover:shadow-indigo-500/50 transition-all duration-300 hover:scale-102 cursor-pointer border-2 border-indigo-400 h-full">
                    <div class="flex flex-col h-full justify-between">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-5xl">üë§</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-1">Player Profile Editor</h3>
                                <p class="text-indigo-100 text-sm">Manage player bios, photos, and information</p>
                            </div>
                        </div>
                        <div class="bg-white/20 rounded-lg px-4 py-2 text-center">
                            <p class="text-white font-semibold text-sm">One-Time Setup</p>
                        </div>
                    </div>
                </div>
            </a>
            
            <a href="career.html" class="block">
                <div class="bg-gradient-to-r from-purple-600 to-pink-700 p-6 rounded-xl shadow-xl hover:shadow-purple-500/50 transition-all duration-300 hover:scale-102 cursor-pointer border-2 border-purple-400 h-full">
                    <div class="flex flex-col h-full justify-between">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-5xl">üìä</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-1">Career Stats Hub</h3>
                                <p class="text-purple-100 text-sm">View automatic career statistics for all players</p>
                            </div>
                        </div>
                        <div class="bg-white/20 rounded-lg px-4 py-2 text-center">
                            <p class="text-white font-semibold text-sm">Auto-Updates</p>
                        </div>
                    </div>
                </div>
            </a>

            <a href="simulator.html" class="block">
                <div class="bg-gradient-to-r from-cyan-600 to-teal-700 p-6 rounded-xl shadow-xl hover:shadow-cyan-500/50 transition-all duration-300 hover:scale-102 cursor-pointer border-2 border-cyan-400 h-full">
                    <div class="flex flex-col h-full justify-between">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-5xl">üé≤</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-1">Match Simulator</h3>
                                <p class="text-cyan-100 text-sm">Predict outcomes & tournament brackets</p>
                            </div>
                        </div>
                        <div class="bg-white/20 rounded-lg px-4 py-2 text-center">
                            <p class="text-white font-semibold text-sm">Offline Available</p>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <!-- Quick Deploy Section -->
        <div class="mt-8">
            <div class="bg-gradient-to-r from-red-600 to-orange-600 p-6 rounded-xl shadow-xl border-2 border-red-400">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2">üöÄ</div>
                    <h3 class="text-3xl font-bold text-white mb-2">Quick Deploy to Results</h3>
                    <p class="text-red-100 text-sm">Upload all event files and deploy to results folder automatically</p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-white/20 rounded-lg p-4">
                        <label class="block text-white font-semibold mb-2 text-sm">Round Robin JSON</label>
                        <input type="file" id="rrFile" accept=".json" class="block w-full text-xs text-gray-200 file:mr-3 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-green-600 file:text-white hover:file:bg-green-700">
                    </div>
                    <div class="bg-white/20 rounded-lg p-4">
                        <label class="block text-white font-semibold mb-2 text-sm">Knockout JSON</label>
                        <input type="file" id="koFile" accept=".json" class="block w-full text-xs text-gray-200 file:mr-3 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-yellow-600 file:text-white hover:file:bg-yellow-700">
                    </div>
                    <div class="bg-white/20 rounded-lg p-4">
                        <label class="block text-white font-semibold mb-2 text-sm">Player Profiles ZIP/JSON</label>
                        <input type="file" id="profileFile" accept=".zip,.json" class="block w-full text-xs text-gray-200 file:mr-3 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-600 file:text-white hover:file:bg-indigo-700">
                    </div>
                </div>

                <button id="deployBtn" class="w-full bg-white text-red-600 font-bold py-4 px-8 rounded-lg text-lg hover:bg-gray-100 transition-all duration-300 shadow-lg hover:shadow-2xl disabled:bg-gray-400 disabled:text-gray-200 disabled:cursor-not-allowed">
                    üöÄ Deploy Complete Event Package
                </button>

                <div id="deployStatus" class="mt-4 p-4 rounded-lg hidden">
                    <p id="statusText" class="text-white font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- All Events Merger Tool -->
        <div class="mt-8">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 rounded-xl shadow-xl border-2 border-indigo-400">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2">üîó</div>
                    <h3 class="text-3xl font-bold text-white mb-2">All Events Merger</h3>
                    <p class="text-indigo-100 text-sm">Merge multiple event JSON files into a single all_events.json for faster loading</p>
                </div>
                
                <div class="bg-white/20 rounded-lg p-4 mb-4">
                    <label class="block text-white font-semibold mb-2">Upload Final Event JSON Files (Multiple)</label>
                    <input type="file" id="mergeEventFiles" accept=".json" multiple class="block w-full text-sm text-gray-200 file:mr-3 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-600 file:text-white hover:file:bg-indigo-700">
                    <p class="text-xs text-indigo-100 mt-2">Select all Final_Series1_EventX.json files you want to merge</p>
                </div>

                <button id="mergeEventsBtn" class="w-full bg-white text-indigo-600 font-bold py-4 px-8 rounded-lg text-lg hover:bg-gray-100 transition-all duration-300 shadow-lg hover:shadow-2xl disabled:bg-gray-400 disabled:text-gray-200 disabled:cursor-not-allowed">
                    üîó Merge Events & Download
                </button>

                <div id="mergeStatus" class="mt-4 p-4 rounded-lg hidden">
                    <p id="mergeStatusText" class="text-white font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- Workflow Guide -->
        <div class="mt-12 bg-gray-800 rounded-xl p-6 border border-gray-700 hidden">
            <h3 class="text-xl font-bold mb-4 text-center text-blue-400">Workflow Guide</h3>
            <div class="flex items-center justify-center space-x-4 text-sm">
                <div class="text-center">
                    <div class="bg-green-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">1</div>
                    <p class="text-gray-400">Round Robin</p>
                    <p class="text-xs text-gray-500">Download RR</p>
                </div>
                <div class="text-2xl text-gray-600">‚Üí</div>
                <div class="text-center">
                    <div class="bg-yellow-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">2</div>
                    <p class="text-gray-400">Knockout</p>
                    <p class="text-xs text-gray-500">Upload RR ‚Üí Download KO</p>
                </div>
                <div class="text-2xl text-gray-600">‚Üí</div>
                <div class="text-center">
                    <div class="bg-purple-600 rounded-full w-12 h-12 flex items-center justify-center font-bold mb-2 mx-auto">3</div>
                    <p class="text-gray-400">Merger</p>
                    <p class="text-xs text-gray-500">Combine ‚Üí Final Stats</p>
                </div>
            </div>
        </div>

        <!-- Sponsors & Partners -->
        <div class="mt-12 bg-gray-800 rounded-xl p-6 border border-gray-700">
            <h3 class="text-lg font-bold mb-6 text-center text-gray-400">Sponsors & Partners</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-6 items-center justify-items-center">
                <a href="https://www.aadsdarts.com/" target="_blank" rel="noopener noreferrer">
                    <img src="logos/AADS OFFIAL LOGO - Copy.png" alt="AADS Official" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <a href="https://www.aadsdarts.com/" target="_blank" rel="noopener noreferrer">
                    <img src="logos/AADSDarts.com Logo.png" alt="AADSDarts.com" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <a href="https://www.youtube.com/@CGCDarts" target="_blank" rel="noopener noreferrer">
                    <img src="logos/CGC-TV Logo - Copy.png" alt="CGC-TV" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <a href="https://cgcdarts.com" target="_blank" rel="noopener noreferrer">
                    <img src="logos/cgcdarts.com logo - Copy.png" alt="CGCDarts.com" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <a href="https://share.google/RICQ8vnCpGQ5nuaGb" target="_blank" rel="noopener noreferrer">
                    <img src="logos/CGCVENUE LOGO.png" alt="CGC Venue" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <a href="https://www.facebook.com/groups/1029382055111128/" target="_blank" rel="noopener noreferrer">
                    <img src="logos/LIVE STREAM CGC LOGO - Copy.png" alt="Live Stream CGC" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300 cursor-pointer">
                </a>
                <img src="logos/MDSTUDIOS - Copy.png" alt="MDStudios" class="h-24 w-auto object-contain opacity-70 hover:opacity-100 hover:scale-110 hover:brightness-125 transition-all duration-300">
            </div>
        </div>

        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>¬© 2025 AADS Stats Director ‚Ä¢ Offline Event Management System</p>
            <p class="mt-2 text-gray-600 text-xs">Made by MDStudios for AADSDarts.com</p>
        </div>
    </div>

    <script>
        document.getElementById('deployBtn').addEventListener('click', async function() {
            const rrFile = document.getElementById('rrFile').files[0];
            const koFile = document.getElementById('koFile').files[0];
            const profileFile = document.getElementById('profileFile').files[0];
            
            if (!rrFile || !koFile || !profileFile) {
                alert('Please upload all three files (RR, KO, and Profiles)');
                return;
            }

            const statusDiv = document.getElementById('deployStatus');
            const statusText = document.getElementById('statusText');
            statusDiv.classList.remove('hidden');
            statusDiv.className = 'mt-4 p-4 rounded-lg bg-blue-600';
            statusText.textContent = 'Processing files...';

            try {
                // Read all files
                const rrData = JSON.parse(await rrFile.text());
                const koData = JSON.parse(await koFile.text());
                
                let playerProfiles = [];
                const zip = new JSZip();
                
                // Handle player profiles (ZIP or JSON)
                if (profileFile.name.endsWith('.zip')) {
                    const zipContent = await JSZip.loadAsync(profileFile);
                    const profileJson = await zipContent.file('player_profiles.json').async('text');
                    playerProfiles = JSON.parse(profileJson);
                    
                    // Extract images from ZIP
                    const imagesFolder = zipContent.folder('images/players');
                    if (imagesFolder) {
                        const imageFiles = [];
                        imagesFolder.forEach((relativePath, file) => {
                            if (!file.dir) {
                                imageFiles.push({ name: relativePath, file: file });
                            }
                        });
                        
                        for (const img of imageFiles) {
                            const imgBlob = await img.file.async('blob');
                            zip.folder('images').folder('players').file(img.name, imgBlob);
                        }
                    }
                } else {
                    playerProfiles = JSON.parse(await profileFile.text());
                }

                // Merge RR + KO into Final event file
                const finalData = {
                    metadata: rrData.metadata,
                    standings: rrData.standings,
                    matches: rrData.matches,
                    knockout: koData.knockout
                };

                const seriesId = rrData.metadata.series_id || 1;
                const eventId = rrData.metadata.event_id || 1;

                // Add files to ZIP
                zip.folder('results').file(`Final_Series${seriesId}_Event${eventId}.json`, JSON.stringify(finalData, null, 2));
                zip.folder('results').file('player_profiles.json', JSON.stringify(playerProfiles, null, 2));

                statusText.textContent = 'Generating deployment package...';

                // Generate and download ZIP
                const blob = await zip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Deploy_Series${seriesId}_Event${eventId}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                statusDiv.className = 'mt-4 p-4 rounded-lg bg-green-600';
                statusText.innerHTML = `
                    ‚úÖ <strong>Deployment package created!</strong><br>
                    Extract the ZIP in your project root folder, then run:<br>
                    <code class="bg-black/30 px-2 py-1 rounded">git add results/ images/; git commit -m "Deploy Event ${eventId}"; git push</code>
                `;

            } catch (error) {
                statusDiv.className = 'mt-4 p-4 rounded-lg bg-red-700';
                statusText.textContent = `‚ùå Error: ${error.message}`;
                console.error(error);
            }
        });

        // All Events Merger functionality
        document.getElementById('mergeEventsBtn').addEventListener('click', async function() {
            const files = document.getElementById('mergeEventFiles').files;
            
            if (!files || files.length === 0) {
                alert('Please select at least one event JSON file to merge!');
                return;
            }

            const statusDiv = document.getElementById('mergeStatus');
            const statusText = document.getElementById('mergeStatusText');
            statusDiv.classList.remove('hidden');
            statusDiv.className = 'mt-4 p-4 rounded-lg bg-blue-600';
            statusText.textContent = `Processing ${files.length} event file(s)...`;

            try {
                const events = [];
                let seriesId = 1;
                
                // Read all event files
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const eventData = JSON.parse(await file.text());
                    
                    // Validate it's an event file
                    if (!eventData.metadata || !eventData.metadata.event_id) {
                        throw new Error(`${file.name} is not a valid event file`);
                    }
                    
                    events.push(eventData);
                    seriesId = eventData.metadata.series_id || 1;
                }

                // Sort events by event_id
                events.sort((a, b) => a.metadata.event_id - b.metadata.event_id);

                // Create merged structure
                const mergedData = {
                    series_id: seriesId,
                    series_name: "Atlantic Amateur Darts Series",
                    events: events
                };

                // Download merged JSON
                const blob = new Blob([JSON.stringify(mergedData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `all_events.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                statusDiv.className = 'mt-4 p-4 rounded-lg bg-green-600';
                statusText.innerHTML = `
                    ‚úÖ <strong>Events merged successfully!</strong><br>
                    Merged ${events.length} event(s) into all_events.json<br>
                    Events: ${events.map(e => e.metadata.event_id).join(', ')}
                `;

            } catch (error) {
                statusDiv.className = 'mt-4 p-4 rounded-lg bg-red-700';
                statusText.textContent = `‚ùå Error: ${error.message}`;
                console.error(error);
            }
        });

    </script>
</body>
</html>
