<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darts Match Simulator - What If Scenarios</title>
    <style>
        :root {
            --primary-orange: #ff6b35;
            --dark-bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-green: #4caf50;
            --accent-red: #f44336;
            --accent-blue: #2196f3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-orange) 0%, #d63031 100%);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .setup-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .player-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .player-card.active {
            border-color: var(--primary-orange);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .player-header h2 {
            font-size: 1.5em;
            color: var(--primary-orange);
        }

        .player-select {
            width: 100%;
            padding: 12px;
            background: var(--dark-bg);
            color: var(--text-primary);
            border: 2px solid var(--primary-orange);
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .stat-group {
            margin-bottom: 15px;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--primary-orange);
            font-weight: 600;
            font-size: 1.2em;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--accent-red), var(--primary-orange), var(--accent-green));
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: none;
        }

        .controls-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .control-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        select, input[type="number"] {
            padding: 10px;
            background: var(--dark-bg);
            color: var(--text-primary);
            border: 2px solid var(--primary-orange);
            border-radius: 8px;
            font-size: 1em;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .toggle-switch input[type="checkbox"] {
            width: 50px;
            height: 25px;
            cursor: pointer;
        }

        .button-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange), #d63031);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6);
        }

        .btn-secondary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-secondary:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-success:hover {
            background: #388e3c;
            transform: translateY(-2px);
        }

        .results-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: none;
        }

        .results-section.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tabbed Interface */
        .tab-container {
            margin-bottom: 30px;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid rgba(255, 107, 0, 0.3);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:hover {
            color: var(--primary-orange);
            background: rgba(255, 107, 0, 0.1);
        }

        .tab-button.active {
            color: var(--primary-orange);
            border-bottom-color: var(--primary-orange);
        }

        .tab-button.completed::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
            color: var(--accent-green);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .tab-section-title {
            font-size: 1.3em;
            color: var(--primary-orange);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 107, 0, 0.3);
        }

        .match-scoreboard {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--dark-bg);
            border-radius: 12px;
        }

        .player-score {
            text-align: center;
        }

        .player-score.winner {
            background: linear-gradient(135deg, var(--accent-green), #2e7d32);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .player-name {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .score {
            font-size: 3em;
            font-weight: 700;
            color: var(--primary-orange);
        }

        .vs-divider {
            text-align: center;
            font-size: 2em;
            color: var(--text-secondary);
            font-weight: 700;
        }

        .match-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box-title {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-box-value {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary-orange);
        }

        .bulk-results {
            background: var(--dark-bg);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .bulk-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: var(--primary-orange);
        }

        .win-probability {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .prob-bar {
            flex: 1;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.5s;
        }

        .prob-bar.p1 {
            background: linear-gradient(135deg, var(--primary-orange), #d63031);
        }

        .prob-bar.p2 {
            background: linear-gradient(135deg, var(--accent-blue), #1565c0);
        }

        .match-log {
            max-height: 400px;
            overflow-y: auto;
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-entry.checkout {
            color: var(--accent-green);
            font-weight: 600;
        }

        .log-entry.bust {
            color: var(--accent-red);
        }

        /* Results Tab Styles */
        .hidden-result {
            display: none;
        }

        .result-title {
            margin-bottom: 20px;
            color: var(--primary-orange);
        }

        .match-log-section {
            margin-top: 20px;
        }

        .log-title {
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        /* Match Recap Styles */
        .recap-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .recap-title {
            color: var(--primary-orange);
            margin: 0 0 15px 0;
            font-size: 1.3em;
            border-bottom: 2px solid var(--primary-orange);
            padding-bottom: 10px;
        }

        .recap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .recap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--dark-bg);
            border-radius: 8px;
            border-left: 3px solid var(--primary-orange);
        }

        .recap-label {
            color: var(--text-secondary);
            font-size: 0.95em;
        }

        .recap-value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1em;
        }

        .highlight-win {
            color: var(--accent-green) !important;
            font-weight: 700 !important;
        }

        .highlight-upset {
            color: var(--accent-red) !important;
            font-weight: 700 !important;
        }

        .highlight-fav {
            color: var(--accent-green) !important;
            font-weight: 700 !important;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.5em;
            color: var(--primary-orange);
        }

        /* Betting Odds Display */
        #oddsBoard {
            margin: 30px auto;
            max-width: 1000px;
        }

        .odds-board {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--primary-orange);
        }

        .odds-header {
            text-align: center;
            font-size: 1.3em;
            color: var(--primary-orange);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .odds-display {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .odds-player {
            text-align: center;
        }

        .odds-player-name {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .odds-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-orange);
            margin-bottom: 5px;
        }

        .odds-prob {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .odds-vs {
            font-size: 2em;
            color: var(--text-secondary);
            font-weight: 700;
        }

        .correct-scores {
            margin-top: 20px;
        }

        .correct-scores-title {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .correct-scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .correct-score-item {
            background: var(--dark-bg);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,107,53,0.3);
        }

        .correct-score-item.likely {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.1);
        }

        .correct-score-label {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .correct-score-prob {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .correct-score-odds {
            font-size: 0.9em;
            color: var(--primary-orange);
            font-weight: 600;
        }

        .format-display {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid var(--primary-orange);
        }

        .format-title {
            font-size: 1em;
            color: var(--primary-orange);
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }

        .format-info {
            font-size: 1.1em;
            color: var(--text-primary);
            text-align: center;
            line-height: 1.6;
        }

        .format-info small {
            display: block;
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-top: 5px;
        }

        /* Prop Markets */
        .prop-market {
            background: var(--dark-bg);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .prop-market-title {
            font-size: 1.05em;
            color: var(--primary-orange);
            margin-bottom: 12px;
            font-weight: 600;
            text-align: center;
        }

        .prop-market-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .prop-market-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px;
            border-radius: 6px;
        }

        .prop-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .prop-odds {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.95em;
            color: var(--text-primary);
        }

        .prop-odds strong {
            color: var(--primary-orange);
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Price Movement Indicators */
        .odds-value {
            transition: background-color 0.5s ease;
            padding: 10px;
            border-radius: 4px;
        }

        .flash-shorten {
            background-color: rgba(239, 68, 68, 0.3);
            animation: flash 0.5s ease-out;
        }

        .flash-drift {
            background-color: rgba(34, 197, 94, 0.3);
            animation: flash 0.5s ease-out;
        }

        @keyframes flash {
            0% { background-color: transparent; }
            50% { opacity: 1; }
            100% { background-color: transparent; }
        }

        .price-arrow {
            font-size: 0.8em;
            margin-left: 5px;
            font-weight: bold;
        }

        .price-down {
            color: #ef4444;
        }

        .price-up {
            color: #22c55e;
        }

        /* Probability Histogram */
        .oracle-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .oracle-title {
            text-align: center;
            font-size: 1.2em;
            color: var(--primary-orange);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .histogram-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 8px;
            padding: 20px;
            background: var(--dark-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .histo-bar {
            flex: 1;
            background: #3b82f6;
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.6s ease-out, background 0.3s;
            min-height: 2%;
        }

        .histo-bar:hover {
            background: #60a5fa;
            cursor: pointer;
        }

        .histo-bar.is-likely {
            background: var(--accent-green);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .histo-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .bar-tooltip {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .histo-bar:hover .bar-tooltip {
            opacity: 1;
        }

        .likely-badge {
            text-align: center;
            margin-top: 35px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 8px;
            color: var(--accent-green);
            font-weight: 600;
        }

        /* Momentum Meter */
        .momentum-meter {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .momentum-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .momentum-bar-container {
            position: relative;
            height: 40px;
            background: var(--dark-bg);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
        }

        .momentum-zone-left {
            flex: 1;
            background: linear-gradient(to right, var(--accent-blue), var(--dark-bg));
        }

        .momentum-zone-right {
            flex: 1;
            background: linear-gradient(to left, var(--accent-red), var(--dark-bg));
        }

        .momentum-needle {
            position: absolute;
            top: 0;
            height: 100%;
            width: 4px;
            background: white;
            box-shadow: 0 0 10px white;
            transition: left 0.5s ease-out;
            z-index: 10;
        }

        .momentum-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .momentum-label {
            font-size: 0.9em;
        }

        .momentum-label.hot {
            color: var(--primary-orange);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @media (max-width: 768px) {
            .setup-section {
                grid-template-columns: 1fr;
            }

            .match-scoreboard {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .vs-divider {
                order: 2;
            }

            .odds-display {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .odds-vs {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Darts Match Simulator</h1>
            <p class="subtitle">Run "What If" scenarios ‚Ä¢ Test your P4P formula ‚Ä¢ Simulate thousands of matches</p>
        </header>

        <!-- Tabbed Navigation -->
        <div class="tab-container">
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('setup')">‚öôÔ∏è Setup</button>
                <button class="tab-button" id="marketsTabBtn" onclick="switchTab('markets')">üìä Markets & Odds</button>
                <button class="tab-button" id="simulateTabBtn" onclick="switchTab('simulate')">üéÆ Simulate</button>
                <button class="tab-button" id="resultsTabBtn" onclick="switchTab('results')">üèÜ Results</button>
            </div>

            <!-- Tab 1: Setup -->
            <div id="setupTab" class="tab-content active">
                <h3 class="tab-section-title">Match Setup</h3>
                
                <!-- Player Setup -->
                <div class="setup-section">
                    <div class="player-card" id="p1Card">
                        <div class="player-header">
                            <h2>Player 1</h2>
                            <span class="stat-value" id="p1P4P">P4P: --</span>
                        </div>
                        <select class="player-select" id="p1Select" onchange="loadPlayer(1)">
                            <option value="">Select Player...</option>
                        </select>
                <div class="stat-group">
                    <div class="stat-label">
                        <span>3-Dart Average</span>
                        <span class="stat-value" id="p1Avg">0.00</span>
                    </div>
                    <div class="stat-label">
                        <span>Checkout Efficiency</span>
                        <span class="stat-value" id="p1CO">0%</span>
                    </div>
                    <div class="stat-label">
                        <span>Match Win Rate</span>
                        <span class="stat-value" id="p1WR">0%</span>
                    </div>
                </div>
                <div class="stat-group">
                    <div class="stat-label">
                        <span>Form Modifier</span>
                        <span class="stat-value" id="p1FormValue">0%</span>
                    </div>
                    <div class="slider-container">
                        <span>-5%</span>
                        <input type="range" id="p1Form" min="-5" max="5" value="0" step="0.5" oninput="updateForm(1)">
                        <span>+5%</span>
                    </div>
                </div>
            </div>

            <div class="player-card" id="p2Card">
                <div class="player-header">
                    <h2>Player 2</h2>
                    <span class="stat-value" id="p2P4P">P4P: --</span>
                </div>
                <select class="player-select" id="p2Select" onchange="loadPlayer(2)">
                    <option value="">Select Player...</option>
                </select>
                <div class="stat-group">
                    <div class="stat-label">
                        <span>3-Dart Average</span>
                        <span class="stat-value" id="p2Avg">0.00</span>
                    </div>
                    <div class="stat-label">
                        <span>Checkout Efficiency</span>
                        <span class="stat-value" id="p2CO">0%</span>
                    </div>
                    <div class="stat-label">
                        <span>Match Win Rate</span>
                        <span class="stat-value" id="p2WR">0%</span>
                    </div>
                </div>
                <div class="stat-group">
                    <div class="stat-label">
                        <span>Form Modifier</span>
                        <span class="stat-value" id="p2FormValue">0%</span>
                    </div>
                    <div class="slider-container">
                        <span>-5%</span>
                        <input type="range" id="p2Form" min="-5" max="5" value="0" step="0.5" oninput="updateForm(2)">
                        <span>+5%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Match Format & Options -->
        <div class="controls-section">
            <div class="control-row">
                <div class="control-group">
                    <label>Match Format</label>
                    <select id="formatSelect">
                        <option value="legs:5">Best of 5 Legs</option>
                        <option value="legs:7">Best of 7 Legs</option>
                        <option value="legs:9">Best of 9 Legs</option>
                        <option value="legs:11" selected>Best of 11 Legs</option>
                        <option value="sets:3">Best of 3 Sets</option>
                        <option value="sets:5">Best of 5 Sets</option>
                        <option value="sets:7">Best of 7 Sets</option>
                        <option value="sets:11">Best of 11 Sets</option>
                        <option value="sets:21">Best of 21 Sets</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="crowdPressure">
                        <span>Crowd Pressure (-10% CO for less experienced)</span>
                    </label>
                </div>

                <div class="control-group">
                    <label>Bulk Simulations</label>
                    <input type="number" id="bulkCount" min="100" max="10000" value="1000" step="100">
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn-success" onclick="switchTab('markets')">Next: View Markets & Odds ‚Üí</button>
        </div>
            </div>

            <!-- Tab 2: Markets & Odds -->
            <div id="marketsTab" class="tab-content">
                <h3 class="tab-section-title">Betting Markets & Odds</h3>
                
                <div id="oddsBoard">
                    <div class="odds-board">
                    <div class="odds-header">üìä Pre-Match Betting Odds</div>
                    <div class="odds-display">
                        <div class="odds-player">
                            <div class="odds-player-name" id="oddsP1Name">Player 1</div>
                            <div class="odds-value" id="oddsP1Value">2.00</div>
                            <div class="odds-prob" id="oddsP1Prob">50.0% Implied</div>
                        </div>
                        <div class="odds-vs">VS</div>
                        <div class="odds-player">
                            <div class="odds-player-name" id="oddsP2Name">Player 2</div>
                            <div class="odds-value" id="oddsP2Value">2.00</div>
                            <div class="odds-prob" id="oddsP2Prob">50.0% Implied</div>
                        </div>
                    </div>
                    
                    <!-- Correct Score Probabilities -->
                    <div class="correct-scores">
                        <div class="correct-scores-title">Most Likely Correct Scores</div>
                        <div class="correct-scores-grid" id="correctScoresGrid"></div>
                    </div>

                    <!-- Probability Histogram (The Oracle) -->
                    <div class="oracle-container">
                        <div class="oracle-title">üîÆ The Oracle: Score Probability Distribution</div>
                        <div id="histogram" class="histogram-chart"></div>
                        <div id="most-likely-label" class="likely-badge">Simulating...</div>
                    </div>

                    <!-- Match Format Display -->
                    <div class="format-display">
                        <div class="format-title">üìã Match Format</div>
                        <div class="format-info" id="formatInfo">--</div>
                    </div>

                    <!-- 180s Markets -->
                    <div class="prop-market">
                        <div class="prop-market-title">üéØ 180s Markets</div>
                        <div class="prop-market-grid">
                            <div class="prop-market-item">
                                <div class="prop-label">Total 180s</div>
                                <div class="prop-odds">
                                    <span>O <span id="total180Line">--</span>: <strong id="total180Over">--</strong></span>
                                    <span>U <span id="total180LineU">--</span>: <strong id="total180Under">--</strong></span>
                                </div>
                            </div>
                            <div class="prop-market-item">
                                <div class="prop-label">Most 180s</div>
                                <div class="prop-odds">
                                    <span><span id="most180P1Name">P1</span>: <strong id="most180P1">--</strong></span>
                                    <span><span id="most180P2Name">P2</span>: <strong id="most180P2">--</strong></span>
                                    <span>Tie: <strong id="most180Tie">--</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Checkout Markets -->
                    <div class="prop-market">
                        <div class="prop-market-title">üèÅ Checkout Markets</div>
                        <div class="prop-market-grid">
                            <div class="prop-market-item">
                                <div class="prop-label">Highest Checkout</div>
                                <div class="prop-odds">
                                    <span><span id="highestP1Name">P1</span>: <strong id="highestP1">--</strong></span>
                                    <span><span id="highestP2Name">P2</span>: <strong id="highestP2">--</strong></span>
                                </div>
                            </div>
                            <div class="prop-market-item">
                                <div class="prop-label">Highest Over 130.5</div>
                                <div class="prop-odds">
                                    <span>Over: <strong id="over130">--</strong></span>
                                    <span>Under: <strong id="under130">--</strong></span>
                                </div>
                            </div>
                            <div class="prop-market-item">
                                <div class="prop-label">170 Checkout</div>
                                <div class="prop-odds">
                                    <span>Yes: <strong id="yes170">--</strong></span>
                                    <span>No: <strong id="no170">--</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Match Treble -->
                    <div class="prop-market">
                        <div class="prop-market-title">üëë Match Treble (Win + Most 180s + Highest CO)</div>
                        <div class="prop-market-grid">
                            <div class="prop-market-item">
                                <div class="prop-odds" style="justify-content: center; gap: 30px;">
                                    <span><span id="trebleP1Name">P1</span> Treble: <strong id="trebleP1">--</strong></span>
                                    <span><span id="trebleP2Name">P2</span> Treble: <strong id="trebleP2">--</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
        <div style="text-align: center; margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
            <button class="btn-secondary" onclick="switchTab('setup')">‚Üê Back to Setup</button>
            <button class="btn-success" onclick="switchTab('simulate')">Next: Simulate Match ‚Üí</button>
        </div>
            </div>

            <!-- Tab 3: Simulate -->
            <div id="simulateTab" class="tab-content">
                <h3 class="tab-section-title">Run Simulation</h3>
                
                <div class="controls-section">
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">
                        Ready to simulate? Choose between a single detailed match or bulk simulations for statistical analysis.
                    </p>
                    
                    <div class="button-row" style="justify-content: center; gap: 20px;">
                        <button class="btn-primary" onclick="simulateSingleMatch()">‚ñ∂Ô∏è Simulate Single Match</button>
                        <button class="btn-secondary" onclick="simulateBulk()">‚ö° Run Bulk Simulation</button>
                        <button class="btn-success" onclick="resetSimulator()">üîÑ Reset All</button>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Results -->
            <div id="resultsTab" class="tab-content">
                <h3 class="tab-section-title">Match Results</h3>
                
                <div id="singleMatchResults" class="hidden-result">
                    <h2 class="result-title">Match Result</h2>
                    <div class="match-scoreboard">
                        <div class="player-score" id="p1ScoreCard">
                            <div class="player-name" id="p1ResultName">Player 1</div>
                            <div class="score" id="p1ResultScore">0</div>
                        </div>
                        <div class="vs-divider">VS</div>
                        <div class="player-score" id="p2ScoreCard">
                            <div class="player-name" id="p2ResultName">Player 2</div>
                            <div class="score" id="p2ResultScore">0</div>
                        </div>
                    </div>

                    <div class="match-stats" id="matchStats"></div>
                    <div class="match-log-section">
                        <h3 class="log-title">Match Log</h3>
                        <div class="match-log" id="matchLog"></div>
                    </div>
                </div>

                <div id="bulkResults" class="hidden-result">
                    <h2 class="bulk-title">Bulk Simulation Results</h2>
                    <div class="win-probability">
                        <div class="prob-bar p1" id="p1ProbBar">
                            <span id="p1ProbText">50%</span>
                        </div>
                        <div class="prob-bar p2" id="p2ProbBar">
                            <span id="p2ProbText">50%</span>
                        </div>
                    </div>
                    <div class="match-stats" id="bulkStats"></div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-secondary" onclick="switchTab('simulate')">‚Üê Back to Simulate</button>
                    <button class="btn-success" onclick="resetSimulator(); switchTab('setup')">Start New Match</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Navigation
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Mark tab button as active
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => {
                if (btn.textContent.includes(getTabTitle(tabName))) {
                    btn.classList.add('active');
                }
            });
            
            // Mark setup as completed when moving to markets
            if (tabName === 'markets' && player1 && player2) {
                document.querySelector('.tab-button').classList.add('completed');
            }
        }
        
        function getTabTitle(tabName) {
            const titles = {
                'setup': 'Setup',
                'markets': 'Markets',
                'simulate': 'Simulate',
                'results': 'Results'
            };
            return titles[tabName] || '';
        }

        // Global state
        let playerData = [];
        let careerStats = {};
        let player1 = null;
        let player2 = null;
        
        // State to track previous odds for price movement arrows
        let previousOdds = { playerA: null, playerB: null };

        // Load player data on page load
        async function loadPlayerData() {
            try {
                // Load career stats from display.html's localStorage or fetch fresh
                const response = await fetch('results/player_profiles.json');
                const profiles = await response.json();
                
                // Load event data to calculate stats
                const manifestResponse = await fetch('results/manifest.json');
                const manifest = await manifestResponse.json();
                
                // Calculate career stats for each player
                const statsMap = {};
                
                for (const eventNum of manifest.available_events) {
                    const eventResponse = await fetch(`results/Final_Series1_Event${eventNum}.json`);
                    const eventData = await eventResponse.json();
                    
                    // Process each player in this event
                    if (!eventData.player_event_stats) continue;
                    
                    for (const playerStats of eventData.player_event_stats) {
                        const playerName = formatNameForDisplay(playerStats.name);
                        
                        if (!statsMap[playerName]) {
                            statsMap[playerName] = {
                                name: playerName,
                                totalMatches: 0,
                                totalWins: 0,
                                totalSets: 0,
                                totalSetsWon: 0,
                                totalLegs: 0,
                                totalLegsWon: 0,
                                totalCoOpp: 0,
                                totalCoComp: 0,
                                total3DA: 0,
                                eventCount: 0
                            };
                        }
                        
                        const stats = statsMap[playerName];
                        stats.totalMatches += playerStats.total_matches;
                        stats.totalWins += playerStats.wins;
                        stats.totalSets += playerStats.total_matches; // Each match is 1 set in our format
                        stats.totalSetsWon += playerStats.wins;
                        stats.totalLegs += playerStats.total_matches * 5; // Estimate avg 5 legs per match
                        stats.totalLegsWon += playerStats.wins * 3; // Estimate 3 legs to win
                        stats.totalCoOpp += playerStats.co_opportunities;
                        stats.totalCoComp += playerStats.co_completed;
                        stats.total3DA += playerStats.final_event_3da;
                        stats.eventCount += 1;
                    }
                }
                
                // Calculate percentages and averages
                for (const playerName in statsMap) {
                    const stats = statsMap[playerName];
                    stats.avg3DA = stats.total3DA / stats.eventCount;
                    stats.coRate = stats.totalCoOpp > 0 ? (stats.totalCoComp / stats.totalCoOpp * 100) : 0;
                    stats.matchWinRate = stats.totalMatches > 0 ? (stats.totalWins / stats.totalMatches * 100) : 0;
                    stats.setWinRate = stats.totalSets > 0 ? (stats.totalSetsWon / stats.totalSets * 100) : 0;
                    stats.legWinRate = stats.totalLegs > 0 ? (stats.totalLegsWon / stats.totalLegs * 100) : 0;
                    
                    // Calculate P4P score
                    const mwr = stats.matchWinRate / 100;
                    const swr = stats.setWinRate / 100;
                    const lwr = stats.legWinRate / 100;
                    const ce = stats.coRate / 100;
                    stats.p4pScore = ((0.20 * mwr) + (0.15 * swr) + (0.25 * lwr) + (0.40 * ce)) * 100;
                }
                
                careerStats = statsMap;
                playerData = Object.values(statsMap).sort((a, b) => b.avg3DA - a.avg3DA);
                
                // Populate player selects
                const p1Select = document.getElementById('p1Select');
                const p2Select = document.getElementById('p2Select');
                
                playerData.forEach(player => {
                    const option1 = document.createElement('option');
                    option1.value = player.name;
                    option1.textContent = `${player.name} (${player.avg3DA.toFixed(2)} avg)`;
                    p1Select.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = player.name;
                    option2.textContent = `${player.name} (${player.avg3DA.toFixed(2)} avg)`;
                    p2Select.appendChild(option2);
                });
                
            } catch (error) {
                console.error('Error loading player data:', error);
                alert('Error loading player data. Make sure results files are available.');
            }
        }

        function formatNameForDisplay(name) {
            if (name.includes(',')) {
                const [last, first] = name.split(',').map(s => s.trim());
                return `${first} ${last}`;
            }
            return name;
        }

        function loadPlayer(playerNum) {
            const selectEl = document.getElementById(`p${playerNum}Select`);
            const playerName = selectEl.value;
            
            if (!playerName) return;
            
            const playerStats = careerStats[playerName];
            if (!playerStats) return;
            
            // Update display
            document.getElementById(`p${playerNum}Avg`).textContent = playerStats.avg3DA.toFixed(2);
            document.getElementById(`p${playerNum}CO`).textContent = playerStats.coRate.toFixed(1) + '%';
            document.getElementById(`p${playerNum}WR`).textContent = playerStats.matchWinRate.toFixed(1) + '%';
            document.getElementById(`p${playerNum}P4P`).textContent = `P4P: ${playerStats.p4pScore.toFixed(1)}`;
            
            // Store player data
            if (playerNum === 1) {
                player1 = {
                    name: playerName,
                    avg: playerStats.avg3DA,
                    checkoutPct: playerStats.coRate,
                    matchWinRate: playerStats.matchWinRate,
                    formBonus: 0
                };
                document.getElementById('p1Card').classList.add('active');
            } else {
                player2 = {
                    name: playerName,
                    avg: playerStats.avg3DA,
                    checkoutPct: playerStats.coRate,
                    matchWinRate: playerStats.matchWinRate,
                    formBonus: 0
                };
                document.getElementById('p2Card').classList.add('active');
            }
        }

        function updateForm(playerNum) {
            const formSlider = document.getElementById(`p${playerNum}Form`);
            const formValue = parseFloat(formSlider.value);
            document.getElementById(`p${playerNum}FormValue`).textContent = `${formValue > 0 ? '+' : ''}${formValue}%`;
            
            if (playerNum === 1 && player1) {
                player1.formBonus = formValue;
            } else if (playerNum === 2 && player2) {
                player2.formBonus = formValue;
            }
        }

        // Mathematical utility functions for betting markets
        function factorial(n) {
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function poisson(k, lambda) {
            const e = Math.E;
            return (Math.pow(lambda, k) * Math.pow(e, -lambda)) / factorial(k);
        }

        // Darts Simulator Class
        class DartsSimulator {
            constructor(p1, p2, format, options = {}) {
                this.p1 = p1;
                this.p2 = p2;
                this.format = format;
                this.options = options;
                this.log = [];
                this.margin = 1.05; // 5% Bookie Vig
            }

            // Calculate P4P-based win probability (Elo-style)
            calculateWinProbability() {
                const p1P4P = this.calculateP4PScore(this.p1);
                const p2P4P = this.calculateP4PScore(this.p2);
                return 1 / (1 + Math.pow(10, (p2P4P - p1P4P) / 40));
            }

            // Calculate P4P score for a player
            calculateP4PScore(player) {
                const mwr = (player.matchWinRate || 50) / 100;
                const lwr = 0.5; // Estimate if not available
                const ce = (player.checkoutPct || 35) / 100;
                return ((0.20 * mwr) + (0.25 * lwr) + (0.40 * ce)) * 100;
            }

            // Get decimal odds with vig
            getDecimalOdds() {
                const probA = this.calculateWinProbability();
                const probB = 1 - probA;
                return {
                    playerA: (1 / (probA * this.margin)).toFixed(2),
                    playerB: (1 / (probB * this.margin)).toFixed(2),
                    impliedProbA: (probA * 100).toFixed(1),
                    impliedProbB: (probB * 100).toFixed(1)
                };
            }

            // Calculate 9-dart odds
            calculateNineDartOdds(player, legsInMatch) {
                const p4pScore = this.calculateP4PScore(player);
                const probPerLeg = (p4pScore / 100) * 0.0008;
                const probInMatch = 1 - Math.pow((1 - probPerLeg), legsInMatch);
                return {
                    yes: (1 / (probInMatch * 1.10)).toFixed(2),
                    no: (1 / ((1 - probInMatch) * 1.05)).toFixed(2),
                    probability: (probInMatch * 100).toFixed(3)
                };
            }

            // Calculate correct score probabilities (Monte Carlo)
            calculateCorrectScoreProbs(sims = 5000) {
                const scoreCounts = {};
                const [type, target] = this.format.split(':');
                const winTarget = type === 'legs' ? Math.ceil(parseInt(target) / 2) : Math.ceil(parseInt(target) / 2);
                const probA = this.calculateWinProbability();

                for (let i = 0; i < sims; i++) {
                    let scoreA = 0, scoreB = 0;
                    
                    if (type === 'legs') {
                        while (scoreA < winTarget && scoreB < winTarget) {
                            Math.random() < probA ? scoreA++ : scoreB++;
                        }
                    } else {
                        // Sets format
                        while (scoreA < winTarget && scoreB < winTarget) {
                            let setScoreA = 0, setScoreB = 0;
                            while (setScoreA < 3 && setScoreB < 3) {
                                Math.random() < probA ? setScoreA++ : setScoreB++;
                            }
                            setScoreA > setScoreB ? scoreA++ : scoreB++;
                        }
                    }
                    
                    const finalScore = `${scoreA}-${scoreB}`;
                    scoreCounts[finalScore] = (scoreCounts[finalScore] || 0) + 1;
                }

                return Object.entries(scoreCounts).map(([score, count]) => {
                    const probability = count / sims;
                    return {
                        score,
                        probability: (probability * 100).toFixed(1),
                        odds: (1 / (probability * this.margin)).toFixed(2),
                        count
                    };
                }).sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
            }

            // Calculate live odds based on current match state
            calculateLiveOdds(state) {
                const [type, target] = this.format.split(':');
                const winTarget = type === 'legs' ? Math.ceil(parseInt(target) / 2) : Math.ceil(parseInt(target) / 2);
                const sims = 5000;
                let winsA = 0;
                
                const baseProbA = this.calculateWinProbability();
                const throwBias = 0.08; // First dart advantage
                
                for (let i = 0; i < sims; i++) {
                    let scoreA = state.scoreA;
                    let scoreB = state.scoreB;
                    let aThrowsNext = state.playerAOnThrow;
                    
                    if (type === 'legs') {
                        while (scoreA < winTarget && scoreB < winTarget) {
                            let currentProb = aThrowsNext ? 
                                Math.min(baseProbA + throwBias, 0.95) : 
                                Math.max(baseProbA - throwBias, 0.05);
                            Math.random() < currentProb ? scoreA++ : scoreB++;
                            aThrowsNext = !aThrowsNext;
                        }
                    } else {
                        // Sets format with throw bias
                        while (scoreA < winTarget && scoreB < winTarget) {
                            let setScoreA = 0, setScoreB = 0;
                            while (setScoreA < 3 && setScoreB < 3) {
                                let currentProb = aThrowsNext ? 
                                    Math.min(baseProbA + throwBias, 0.95) : 
                                    Math.max(baseProbA - throwBias, 0.05);
                                Math.random() < currentProb ? setScoreA++ : setScoreB++;
                                aThrowsNext = !aThrowsNext;
                            }
                            setScoreA > setScoreB ? scoreA++ : scoreB++;
                        }
                    }
                    
                    if (scoreA === winTarget) winsA++;
                }
                
                const liveProbA = winsA / sims;
                return {
                    playerA: (1 / (liveProbA * this.margin)).toFixed(2),
                    playerB: (1 / ((1 - liveProbA) * this.margin)).toFixed(2),
                    winChanceA: (liveProbA * 100).toFixed(1),
                    winChanceB: ((1 - liveProbA) * 100).toFixed(1)
                };
            }

            // Generate a realistic visit score based on average
            generateVisit(avg) {
                // Base probability distribution based on average
                // Higher averages = more likely to hit big scores
                
                const avgFactor = avg / 180; // Normalize to 0-1 scale
                const rand = Math.random();
                
                // Weighted probability for different score ranges
                if (rand < avgFactor * 0.15) {
                    // 180 (15% chance at peak skill)
                    return 180;
                } else if (rand < avgFactor * 0.30) {
                    // 140-179 (15% chance)
                    return Math.floor(Math.random() * 40) + 140;
                } else if (rand < avgFactor * 0.55) {
                    // 100-139 (25% chance)
                    return Math.floor(Math.random() * 40) + 100;
                } else if (rand < 0.80) {
                    // 60-99 (25% chance)
                    return Math.floor(Math.random() * 40) + 60;
                } else {
                    // 26-59 (20% chance for poor visits)
                    return Math.floor(Math.random() * 34) + 26;
                }
            }

            // Try to checkout based on efficiency percentage
            tryCheckout(checkoutPct) {
                // Apply crowd pressure modifier if enabled
                let effectivePct = checkoutPct;
                if (this.options.crowdPressure) {
                    // Reduce checkout % by 10% for less experienced player
                    const p1Experience = this.p1.matchWinRate || 50;
                    const p2Experience = this.p2.matchWinRate || 50;
                    
                    if (p1Experience > p2Experience + 10) {
                        this.p2.checkoutPct *= 0.9;
                    } else if (p2Experience > p1Experience + 10) {
                        this.p1.checkoutPct *= 0.9;
                    }
                }
                
                return Math.random() * 100 < effectivePct;
            }

            // ============ PROP MARKETS ============
            
            // 180s Markets
            calculate180sMarkets(estimatedLegs) {
                const p1Stats = careerStats[this.p1.name];
                const p2Stats = careerStats[this.p2.name];
                
                const p1Freq = (p1Stats?.avg180PerLeg || 0.15);
                const p2Freq = (p2Stats?.avg180PerLeg || 0.15);
                const combinedFreq = p1Freq + p2Freq;
                const lambda = estimatedLegs * combinedFreq;
                
                // Total 180s Over/Under
                const line = Math.floor(lambda) + 0.5;
                let probUnder = 0;
                for (let i = 0; i <= Math.floor(line); i++) {
                    probUnder += poisson(i, lambda);
                }
                
                // Most 180s (3-way)
                const p1Expected = estimatedLegs * p1Freq;
                const p2Expected = estimatedLegs * p2Freq;
                const probP1Most = p1Expected / (p1Expected + p2Expected + 0.5);
                const probP2Most = p2Expected / (p1Expected + p2Expected + 0.5);
                const probTie = 0.5 / (p1Expected + p2Expected + 0.5);
                
                return {
                    totalLine: line,
                    overOdds: (1 / ((1 - probUnder) * this.margin)).toFixed(2),
                    underOdds: (1 / (probUnder * this.margin)).toFixed(2),
                    most180sP1: (1 / (probP1Most * this.margin)).toFixed(2),
                    most180sP2: (1 / (probP2Most * this.margin)).toFixed(2),
                    most180sTie: (1 / (probTie * this.margin)).toFixed(2),
                    p1PlayerLine: (p1Expected - 0.5).toFixed(1),
                    p2PlayerLine: (p2Expected - 0.5).toFixed(1)
                };
            }

            // Checkout Markets
            calculateCheckoutMarkets() {
                const p1Stats = careerStats[this.p1.name];
                const p2Stats = careerStats[this.p2.name];
                
                const p1Peak = p1Stats?.peakFinish || 120;
                const p2Peak = p2Stats?.peakFinish || 120;
                const p1HighTonProb = (p1Stats?.highFinishRate || 0.10);
                const p2HighTonProb = (p2Stats?.highFinishRate || 0.10);
                
                // Highest Checkout market
                const probP1Highest = p1Peak / (p1Peak + p2Peak);
                const probP2Highest = 1 - probP1Highest;
                
                // Highest Checkout O/U 130.5
                const maxPeak = Math.max(p1Peak, p2Peak);
                const probOver130 = maxPeak > 130 ? 0.65 : 0.35;
                
                // 170 Checkout (Yes/No)
                const prob170 = Math.max(p1HighTonProb, p2HighTonProb) * 0.05;
                
                return {
                    highestP1: (1 / (probP1Highest * this.margin)).toFixed(2),
                    highestP2: (1 / (probP2Highest * this.margin)).toFixed(2),
                    over130: (1 / (probOver130 * this.margin)).toFixed(2),
                    under130: (1 / ((1 - probOver130) * this.margin)).toFixed(2),
                    yes170: (1 / (prob170 * 1.10)).toFixed(2),
                    no170: (1 / ((1 - prob170) * 1.05)).toFixed(2)
                };
            }

            // Handicap Market
            calculateHandicapMarket(handicap) {
                const probA = this.calculateWinProbability();
                const [type, target] = this.format.split(':');
                const totalLegs = type === 'legs' ? parseInt(target) : parseInt(target) * 3;
                
                // Adjust win probability based on handicap
                const adjustedProb = probA + (handicap * 0.05);
                const clampedProb = Math.max(0.05, Math.min(0.95, adjustedProb));
                
                return {
                    playerAHandicap: (1 / (clampedProb * this.margin)).toFixed(2),
                    playerBHandicap: (1 / ((1 - clampedProb) * this.margin)).toFixed(2)
                };
            }

            // Match Treble (Win + Most 180s + Highest Checkout)
            calculateMatchTreble(estimatedLegs) {
                const winProb = this.calculateWinProbability();
                const markets180 = this.calculate180sMarkets(estimatedLegs);
                const checkoutMarkets = this.calculateCheckoutMarkets();
                
                const probP1Treble = winProb * (1 / parseFloat(markets180.most180sP1)) * (1 / parseFloat(checkoutMarkets.highestP1));
                const probP2Treble = (1 - winProb) * (1 / parseFloat(markets180.most180sP2)) * (1 / parseFloat(checkoutMarkets.highestP2));
                
                return {
                    p1Treble: (1 / (probP1Treble * this.margin)).toFixed(2),
                    p2Treble: (1 / (probP2Treble * this.margin)).toFixed(2)
                };
            }

            // Simulate a single leg (501 game)
            simulateLeg(starter, logEnabled = false) {
                let scores = [501, 501];
                let turn = starter; // 0 for p1, 1 for p2
                let visitCount = [0, 0];
                let checkoutAttempts = [0, 0];
                
                while (scores[0] > 0 && scores[1] > 0) {
                    const p = (turn === 0) ? this.p1 : this.p2;
                    const playerName = p.name;
                    
                    // Apply form bonus to average
                    const effectiveAvg = p.avg + (p.avg * (p.formBonus / 100));
                    
                    // Generate visit score
                    let visit = this.generateVisit(effectiveAvg);
                    visitCount[turn]++;
                    
                    // Check if score allows for checkout (2-170)
                    if (scores[turn] <= 170 && scores[turn] >= 2) {
                        checkoutAttempts[turn]++;
                        
                        if (this.tryCheckout(p.checkoutPct)) {
                            scores[turn] = 0;
                            if (logEnabled) {
                                this.log.push(`üéØ ${playerName} checks out ${scores[turn]} to WIN the leg!`);
                            }
                            return {
                                winner: turn,
                                visits: visitCount,
                                checkoutAttempts
                            };
                        } else {
                            if (logEnabled) {
                                this.log.push(`‚ùå ${playerName} misses checkout on ${scores[turn]}`);
                            }
                        }
                    }
                    
                    // Apply score
                    const newScore = scores[turn] - visit;
                    
                    if (newScore < 2) {
                        // Bust
                        if (logEnabled) {
                            this.log.push(`üí• ${playerName} scores ${visit} - BUST! (${scores[turn]} remaining)`);
                        }
                    } else {
                        scores[turn] = newScore;
                        if (logEnabled) {
                            this.log.push(`${playerName} scores ${visit} (${scores[turn]} remaining)`);
                        }
                    }
                    
                    turn = 1 - turn; // Switch turns
                }
            }

            // Simulate a single match
            simulateMatch(logEnabled = false) {
                const [type, target] = this.format.split(':');
                const legsToWin = type === 'legs' ? Math.ceil(parseInt(target) / 2) : null;
                const setsToWin = type === 'sets' ? Math.ceil(parseInt(target) / 2) : null;
                
                let matchScore = [0, 0];
                let totalLegs = [0, 0];
                let totalVisits = [0, 0];
                let totalCheckoutAttempts = [0, 0];
                let starter = Math.random() < 0.5 ? 0 : 1; // Random starter
                
                this.log = [];
                
                if (type === 'legs') {
                    // Best of X legs format
                    while (matchScore[0] < legsToWin && matchScore[1] < legsToWin) {
                        const legResult = this.simulateLeg(starter, logEnabled);
                        matchScore[legResult.winner]++;
                        totalLegs[legResult.winner]++;
                        totalVisits[0] += legResult.visits[0];
                        totalVisits[1] += legResult.visits[1];
                        totalCheckoutAttempts[0] += legResult.checkoutAttempts[0];
                        totalCheckoutAttempts[1] += legResult.checkoutAttempts[1];
                        
                        if (logEnabled) {
                            this.log.push(`--- Leg won by ${legResult.winner === 0 ? this.p1.name : this.p2.name} ---`);
                            this.log.push(`Score: ${this.p1.name} ${matchScore[0]} - ${matchScore[1]} ${this.p2.name}`);
                            this.log.push('');
                        }
                        
                        starter = 1 - starter; // Alternate starter
                    }
                } else {
                    // Best of X sets format (each set is best of 5 legs)
                    while (matchScore[0] < setsToWin && matchScore[1] < setsToWin) {
                        let setScore = [0, 0];
                        
                        while (setScore[0] < 3 && setScore[1] < 3) {
                            const legResult = this.simulateLeg(starter, logEnabled);
                            setScore[legResult.winner]++;
                            totalLegs[legResult.winner]++;
                            totalVisits[0] += legResult.visits[0];
                            totalVisits[1] += legResult.visits[1];
                            totalCheckoutAttempts[0] += legResult.checkoutAttempts[0];
                            totalCheckoutAttempts[1] += legResult.checkoutAttempts[1];
                            starter = 1 - starter;
                        }
                        
                        const setWinner = setScore[0] > setScore[1] ? 0 : 1;
                        matchScore[setWinner]++;
                        
                        if (logEnabled) {
                            this.log.push(`--- Set won by ${setWinner === 0 ? this.p1.name : this.p2.name} (${setScore[0]}-${setScore[1]}) ---`);
                            this.log.push(`Match Score: ${this.p1.name} ${matchScore[0]} - ${matchScore[1]} ${this.p2.name}`);
                            this.log.push('');
                        }
                    }
                }
                
                const winner = matchScore[0] > matchScore[1] ? 0 : 1;
                
                return {
                    winner,
                    score: matchScore,
                    legs: totalLegs,
                    visits: totalVisits,
                    checkoutAttempts: totalCheckoutAttempts,
                    log: this.log
                };
            }
        }

        // Render probability histogram (The Oracle)
        function renderOracle(scoreData) {
            const chart = document.getElementById('histogram');
            chart.innerHTML = '';

            // Sort scores logically
            const sortedScores = Object.entries(scoreData).sort((a, b) => {
                const [a1, a2] = a[0].split('-').map(Number);
                const [b1, b2] = b[0].split('-').map(Number);
                return (b1 - b2) - (a1 - a2); // Sort by margin
            });
            
            // Find the highest frequency to scale the bars
            const maxVal = Math.max(...Object.values(scoreData));
            const likelyScore = Object.keys(scoreData).reduce((a, b) => 
                scoreData[a] > scoreData[b] ? a : b
            );
            const totalSims = Object.values(scoreData).reduce((sum, val) => sum + val, 0);

            sortedScores.forEach(([score, count]) => {
                const percentage = (count / maxVal) * 100;
                const realProb = ((count / totalSims) * 100).toFixed(1);

                const bar = document.createElement('div');
                bar.className = `histo-bar ${score === likelyScore ? 'is-likely' : ''}`;
                bar.style.height = `${percentage}%`;
                
                bar.innerHTML = `
                    <span class="histo-label">${score}</span>
                    <div class="bar-tooltip">${realProb}%</div>
                `;

                chart.appendChild(bar);
            });

            const likelyProb = ((scoreData[likelyScore] / totalSims) * 100).toFixed(1);
            document.getElementById('most-likely-label').innerText = 
                `Most Likely Score: ${likelyScore} (${likelyProb}% probability)`;
        }

        // Update odds display with price movement arrows
        function updateOddsWithMovement(newOdds) {
            const p1ValueEl = document.getElementById('oddsP1Value');
            const p2ValueEl = document.getElementById('oddsP2Value');
            
            // Helper to determine arrow direction and color
            const getMovement = (current, previous) => {
                if (!previous) return { icon: '', colorClass: '' };
                const curr = parseFloat(current);
                const prev = parseFloat(previous);
                if (curr < prev) return { icon: '‚ñº', colorClass: 'price-down' }; // Shortening
                if (curr > prev) return { icon: '‚ñ≤', colorClass: 'price-up' }; // Drifting
                return { icon: '', colorClass: '' };
            };

            const moveA = getMovement(newOdds.playerA, previousOdds.playerA);
            const moveB = getMovement(newOdds.playerB, previousOdds.playerB);

            // Add flash effect
            if (moveA.icon) {
                p1ValueEl.classList.add(moveA.colorClass === 'price-down' ? 'flash-shorten' : 'flash-drift');
                setTimeout(() => {
                    p1ValueEl.classList.remove('flash-shorten', 'flash-drift');
                }, 500);
            }
            if (moveB.icon) {
                p2ValueEl.classList.add(moveB.colorClass === 'price-down' ? 'flash-shorten' : 'flash-drift');
                setTimeout(() => {
                    p2ValueEl.classList.remove('flash-shorten', 'flash-drift');
                }, 500);
            }

            // Update UI with arrows
            p1ValueEl.innerHTML = `${newOdds.playerA} ${moveA.icon ? `<span class="price-arrow ${moveA.colorClass}">${moveA.icon}</span>` : ''}`;
            p2ValueEl.innerHTML = `${newOdds.playerB} ${moveB.icon ? `<span class="price-arrow ${moveB.colorClass}">${moveB.icon}</span>` : ''}`;

            // Save current odds as previous for next update
            previousOdds = { playerA: newOdds.playerA, playerB: newOdds.playerB };
        }

        // Show odds board with betting information
        function showOddsBoard(sim, format) {
            // Switch to markets tab and show odds
            switchTab('markets');
            
            // Mark markets tab button as ready
            document.getElementById('marketsTabBtn').classList.add('completed');
            
            const oddsBoard = document.getElementById('oddsBoard');
            oddsBoard.style.display = 'block';
            
            // Get match winner odds and apply price movement
            const odds = sim.getDecimalOdds();
            document.getElementById('oddsP1Name').textContent = player1.name;
            document.getElementById('oddsP2Name').textContent = player2.name;
            updateOddsWithMovement(odds); // Use the new function with arrows
            document.getElementById('oddsP1Prob').textContent = `${odds.impliedProbA}% Implied`;
            document.getElementById('oddsP2Prob').textContent = `${odds.impliedProbB}% Implied`;
            
            // Calculate correct score probabilities with higher sample for histogram
            const correctScores = sim.calculateCorrectScoreProbs(10000);
            
            // Build score data object for histogram
            const scoreData = {};
            correctScores.forEach(item => {
                scoreData[item.score] = Math.round((parseFloat(item.probability) / 100) * 10000);
            });
            
            // Render the probability histogram
            renderOracle(scoreData);
            
            // Display top 8 scores in the grid
            const correctScoresHTML = correctScores.slice(0, 8).map((item, index) => {
                const isLikely = index < 3;
                return `
                    <div class="correct-score-item ${isLikely ? 'likely' : ''}">
                        <div class="correct-score-label">${item.score}</div>
                        <div class="correct-score-prob">${item.probability}%</div>
                        <div class="correct-score-odds">${item.odds}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('correctScoresGrid').innerHTML = correctScoresHTML;
            
            // Display match format and estimate legs
            const [type, target] = format.split(':');
            const estimatedLegs = type === 'legs' ? parseInt(target) * 0.85 : parseInt(target) * 4;
            let formatText = '';
            if (type === 'legs') {
                formatText = `Best of ${target} Legs (First to ${Math.ceil(parseInt(target) / 2)})`;
            } else {
                formatText = `Best of ${target} Sets (First to ${Math.ceil(parseInt(target) / 2)})<br><small>Each set: Best of 5 legs (First to 3)</small>`;
            }
            document.getElementById('formatInfo').innerHTML = formatText;

            // Calculate and display 180s markets
            const markets180 = sim.calculate180sMarkets(estimatedLegs);
            document.getElementById('total180Line').textContent = markets180.totalLine;
            document.getElementById('total180LineU').textContent = markets180.totalLine;
            document.getElementById('total180Over').textContent = markets180.overOdds;
            document.getElementById('total180Under').textContent = markets180.underOdds;
            document.getElementById('most180P1Name').textContent = player1.name;
            document.getElementById('most180P2Name').textContent = player2.name;
            document.getElementById('most180P1').textContent = markets180.most180sP1;
            document.getElementById('most180P2').textContent = markets180.most180sP2;
            document.getElementById('most180Tie').textContent = markets180.most180sTie;

            // Calculate and display checkout markets
            const checkoutMarkets = sim.calculateCheckoutMarkets();
            document.getElementById('highestP1Name').textContent = player1.name;
            document.getElementById('highestP2Name').textContent = player2.name;
            document.getElementById('highestP1').textContent = checkoutMarkets.highestP1;
            document.getElementById('highestP2').textContent = checkoutMarkets.highestP2;
            document.getElementById('over130').textContent = checkoutMarkets.over130;
            document.getElementById('under130').textContent = checkoutMarkets.under130;
            document.getElementById('yes170').textContent = checkoutMarkets.yes170;
            document.getElementById('no170').textContent = checkoutMarkets.no170;

            // Calculate and display match treble
            const trebleMarkets = sim.calculateMatchTreble(estimatedLegs);
            document.getElementById('trebleP1Name').textContent = player1.name;
            document.getElementById('trebleP2Name').textContent = player2.name;
            document.getElementById('trebleP1').textContent = trebleMarkets.p1Treble;
            document.getElementById('trebleP2').textContent = trebleMarkets.p2Treble;
        }

        // UI Functions
        function simulateSingleMatch() {
            if (!player1 || !player2) {
                alert('Please select both players first!');
                return;
            }
            
            const format = document.getElementById('formatSelect').value;
            const crowdPressure = document.getElementById('crowdPressure').checked;
            
            const sim = new DartsSimulator(player1, player2, format, { crowdPressure });
            
            // Calculate all pre-match data
            const odds = sim.getDecimalOdds();
            const correctScores = sim.calculateCorrectScoreProbs();
            
            // Display pre-match odds board
            showOddsBoard(sim, format);
            
            // Run the match simulation
            const result = sim.simulateMatch(true);
            
            // Switch to results tab
            switchTab('results');
            
            // Display results
            document.getElementById('singleMatchResults').classList.remove('hidden-result');
            document.getElementById('bulkResults').classList.add('hidden-result');
            
            // Update scoreboard
            document.getElementById('p1ResultName').textContent = player1.name;
            document.getElementById('p2ResultName').textContent = player2.name;
            document.getElementById('p1ResultScore').textContent = result.score[0];
            document.getElementById('p2ResultScore').textContent = result.score[1];
            
            // Highlight winner
            const p1Card = document.getElementById('p1ScoreCard');
            const p2Card = document.getElementById('p2ScoreCard');
            p1Card.classList.remove('winner');
            p2Card.classList.remove('winner');
            
            if (result.winner === 0) {
                p1Card.classList.add('winner');
            } else {
                p2Card.classList.add('winner');
            }
            
            // Build comprehensive match recap
            const [formatType, target] = format.split(':');
            const scoreLabel = formatType === 'sets' ? 'Sets' : 'Legs';
            const finalScore = `${result.score[0]}-${result.score[1]}`;
            const actualCorrectScore = correctScores.find(s => s.score === finalScore);
            
            const recapHTML = `
                <!-- P4P Stats Section -->
                <div class="recap-section">
                    <h3 class="recap-title">‚öñÔ∏è Pre-Match P4P Analysis</h3>
                    <div class="recap-grid">
                        <div class="recap-item">
                            <span class="recap-label">${player1.name} P4P Score</span>
                            <span class="recap-value">${player1.final_event_3da.toFixed(1)}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player2.name} P4P Score</span>
                            <span class="recap-value">${player2.final_event_3da.toFixed(1)}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">P4P Differential</span>
                            <span class="recap-value">${Math.abs(player1.final_event_3da - player2.final_event_3da).toFixed(1)}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">Predicted Win Probability</span>
                            <span class="recap-value">${player1.name} ${odds.impliedProbA}% / ${player2.name} ${odds.impliedProbB}%</span>
                        </div>
                    </div>
                </div>

                <!-- Betting Market Section -->
                <div class="recap-section">
                    <h3 class="recap-title">üí∞ Betting Markets Analysis</h3>
                    <div class="recap-grid">
                        <div class="recap-item">
                            <span class="recap-label">Match Winner Odds</span>
                            <span class="recap-value">${player1.name} @${odds.playerA} | ${player2.name} @${odds.playerB}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">Pre-Match Favorite</span>
                            <span class="recap-value">${odds.playerA < odds.playerB ? player1.name : player2.name} (${Math.min(odds.playerA, odds.playerB)} odds)</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">Correct Score Probability</span>
                            <span class="recap-value">${finalScore}: ${actualCorrectScore ? actualCorrectScore.probability : 'N/A'}% (@${actualCorrectScore ? actualCorrectScore.odds : 'N/A'})</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">Match Format</span>
                            <span class="recap-value">${formatType === 'sets' ? `Best of ${target} Sets (Each set: Best of 5 legs)` : `Best of ${target} Legs`}</span>
                        </div>
                    </div>
                </div>

                <!-- Match Result Section -->
                <div class="recap-section">
                    <h3 class="recap-title">üéØ Match Statistics</h3>
                    <div class="recap-grid">
                        <div class="recap-item">
                            <span class="recap-label">${player1.name} ${scoreLabel}</span>
                            <span class="recap-value">${result.score[0]}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player2.name} ${scoreLabel}</span>
                            <span class="recap-value">${result.score[1]}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player1.name} Total Legs</span>
                            <span class="recap-value">${result.legs[0]}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player2.name} Total Legs</span>
                            <span class="recap-value">${result.legs[1]}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player1.name} Avg Visits/Leg</span>
                            <span class="recap-value">${(result.visits[0] / result.legs[0]).toFixed(1)}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player2.name} Avg Visits/Leg</span>
                            <span class="recap-value">${(result.visits[1] / result.legs[1]).toFixed(1)}</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player1.name} Checkout %</span>
                            <span class="recap-value">${result.checkoutAttempts[0] > 0 ? ((result.legs[0] / result.checkoutAttempts[0]) * 100).toFixed(1) : 0}%</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">${player2.name} Checkout %</span>
                            <span class="recap-value">${result.checkoutAttempts[1] > 0 ? ((result.legs[1] / result.checkoutAttempts[1]) * 100).toFixed(1) : 0}%</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">Betting Result</span>
                            <span class="recap-value ${result.winner === 0 ? (odds.playerA < odds.playerB ? 'highlight-fav' : 'highlight-upset') : (odds.playerB < odds.playerA ? 'highlight-fav' : 'highlight-upset')}">
                                ${result.winner === 0 ? player1.name : player2.name} Wins ${result.winner === 0 ? (odds.playerA > odds.playerB ? '(UPSET!)' : '(Favorite)') : (odds.playerB > odds.playerA ? '(UPSET!)' : '(Favorite)')}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('matchStats').innerHTML = recapHTML;
            
            // Display match log
            const logHTML = result.log.map(entry => {
                let className = 'log-entry';
                if (entry.includes('WIN')) className += ' checkout';
                if (entry.includes('BUST')) className += ' bust';
                return `<div class="${className}">${entry}</div>`;
            }).join('');
            document.getElementById('matchLog').innerHTML = logHTML;
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function simulateBulk() {
            if (!player1 || !player2) {
                alert('Please select both players first!');
                return;
            }
            
            const format = document.getElementById('formatSelect').value;
            const crowdPressure = document.getElementById('crowdPressure').checked;
            const bulkCount = parseInt(document.getElementById('bulkCount').value);
            
            // Switch to results tab
            switchTab('results');
            
            // Show loading
            document.getElementById('singleMatchResults').classList.add('hidden-result');
            document.getElementById('bulkResults').classList.remove('hidden-result');
            document.getElementById('bulkResults').innerHTML = '<div class="loading">Simulating matches...</div>';
            
            // Run simulations asynchronously to not block UI
            setTimeout(() => {
                let p1Wins = 0;
                let p2Wins = 0;
                let totalP1Legs = 0;
                let totalP2Legs = 0;
                let totalP1Score = 0;
                let totalP2Score = 0;
                
                for (let i = 0; i < bulkCount; i++) {
                    const sim = new DartsSimulator(player1, player2, format, { crowdPressure });
                    const result = sim.simulateMatch(false);
                    
                    if (result.winner === 0) {
                        p1Wins++;
                    } else {
                        p2Wins++;
                    }
                    
                    totalP1Legs += result.legs[0];
                    totalP2Legs += result.legs[1];
                    totalP1Score += result.score[0];
                    totalP2Score += result.score[1];
                }
                
                // Calculate statistics
                const p1WinPct = (p1Wins / bulkCount * 100).toFixed(1);
                const p2WinPct = (p2Wins / bulkCount * 100).toFixed(1);
                const avgP1Legs = (totalP1Legs / bulkCount).toFixed(1);
                const avgP2Legs = (totalP2Legs / bulkCount).toFixed(1);
                const avgP1Score = (totalP1Score / bulkCount).toFixed(1);
                const avgP2Score = (totalP2Score / bulkCount).toFixed(1);
                
                // Display results
                const resultsHTML = `
                    <h2 class="bulk-title">Bulk Simulation Results (${bulkCount.toLocaleString()} matches)</h2>
                    <div class="win-probability">
                        <div class="prob-bar p1" style="flex: ${p1WinPct}">
                            <span>${player1.name}: ${p1WinPct}%</span>
                        </div>
                        <div class="prob-bar p2" style="flex: ${p2WinPct}">
                            <span>${player2.name}: ${p2WinPct}%</span>
                        </div>
                    </div>
                    <div class="match-stats">
                        <div class="stat-box">
                            <div class="stat-box-title">${player1.name} Wins</div>
                            <div class="stat-box-value">${p1Wins.toLocaleString()}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-title">${player2.name} Wins</div>
                            <div class="stat-box-value">${p2Wins.toLocaleString()}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-title">Avg ${player1.name} Legs/Match</div>
                            <div class="stat-box-value">${avgP1Legs}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-title">Avg ${player2.name} Legs/Match</div>
                            <div class="stat-box-value">${avgP2Legs}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-title">Avg ${player1.name} Score</div>
                            <div class="stat-box-value">${avgP1Score}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-title">Avg ${player2.name} Score</div>
                            <div class="stat-box-value">${avgP2Score}</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 20px; background: var(--dark-bg); border-radius: 8px;">
                        <h3 style="color: var(--primary-orange); margin-bottom: 10px;">P4P Validation</h3>
                        <p style="color: var(--text-secondary); line-height: 1.6;">
                            Based on ${bulkCount.toLocaleString()} simulations, <strong style="color: var(--text-primary);">${p1WinPct > p2WinPct ? player1.name : player2.name}</strong> 
                            is the statistical favorite with a <strong style="color: var(--primary-orange);">${Math.max(p1WinPct, p2WinPct)}%</strong> win rate.
                            ${format.includes('sets') ? 'In set-based formats, consistency and mental fortitude become even more critical.' : 'In leg-based formats, checkout efficiency has a major impact.'}
                        </p>
                    </div>
                `;
                
                document.getElementById('bulkResults').innerHTML = resultsHTML;
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function resetSimulator() {
            document.getElementById('p1Select').value = '';
            document.getElementById('p2Select').value = '';
            document.getElementById('p1Form').value = 0;
            document.getElementById('p2Form').value = 0;
            document.getElementById('crowdPressure').checked = false;
            
            document.getElementById('p1Avg').textContent = '0.00';
            document.getElementById('p2Avg').textContent = '0.00';
            document.getElementById('p1CO').textContent = '0%';
            document.getElementById('p2CO').textContent = '0%';
            document.getElementById('p1WR').textContent = '0%';
            document.getElementById('p2WR').textContent = '0%';
            document.getElementById('p1P4P').textContent = 'P4P: --';
            document.getElementById('p2P4P').textContent = 'P4P: --';
            document.getElementById('p1FormValue').textContent = '0%';
            document.getElementById('p2FormValue').textContent = '0%';
            
            document.getElementById('p1Card').classList.remove('active');
            document.getElementById('p2Card').classList.remove('active');
            
            // Hide results and odds
            document.getElementById('singleMatchResults').classList.add('hidden-result');
            document.getElementById('bulkResults').classList.add('hidden-result');
            document.getElementById('oddsBoard').style.display = 'none';
            
            // Remove completed badges from tabs
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('completed');
            });
            
            // Switch back to setup tab
            switchTab('setup');
            
            player1 = null;
            player2 = null;
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', loadPlayerData);
    </script>
</body>
</html>
